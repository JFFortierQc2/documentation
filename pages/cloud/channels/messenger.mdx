# Messenger

![Messaging channels](/docs/content/messenger-banner.png)

<iframe
  data-youtube-iframe
  width="720"
  height="360"
  src="https://www.youtube.com/embed/pOIrLMpZZqc"
  title="YouTube video player"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  allowfullscreen
></iframe>

## Prerequisites

- A [Meta developer app](https://developers.facebook.com/apps/create/) that will serve as the primary platform for managing connection between Messenger and Botpress, including the configuration of webhooks and access tokens.
- A [Facebook page](https://www.facebook.com/pages/create/) that you own or has the developer role, this is needed to use the Messenger API.
- A [Botpress Cloud account](https://sso.botpress.cloud) and a [Botpress Bot](https://botpress.com/docs/cloud/getting-started/create-and-publish-your-chatbot/)

## Setting up the Messenger integration in Botpress

1. Go to the [Integration Hub](https://app.botpress.cloud/hub) in Botpress Cloud (if you don't have the integration installed yet).
1. Find and open the Messenger integration then click on the "Install to Bot" button, now go back to your bot settings.

The Messenger integration has the following settings:

- **Enabled**: Whether Botpress will communicate with Messenger
- **Webhook URL**: The URL for receiving data in Botpress
- **App Id**: The id of your Meta App
- **App Secret**: The secret of your Meta App
- **Verify Token**: The token used to verify the webhook requests
- **Page Id**: The id of your Facebook page
- **Access Token**: The access token used to send messages to the Messenger API

## Setting up Messenger

### Create a Facebook Page

If you do not already have a Facebook page you will need to create one. You can find details on how to create a new Facebook page [here](https://www.facebook.com/pages/create/). To link your chatbot to a pre-existing page, you must have an administrator or developer role.

### Messenger API version

Botpress can only interact with the version 15.0 or higher of the Messenger API. It is not the default version in the app settings so it must be changed.

1. Go to your Meta app start page
1. In the left sidebar, expand the **Settings** menu and select **Advanced**
1. In the **Upgrade API version** section, select v15.0 or higher as the API version
1. Click on **Save changes**

### Add Messenger Product

Messenger is not added by default in your Meta app, so it must be added manually

1. In the left sidebar, click on **Add Product**
1. In the Facebook Messenger section click **Set Up**

### App Id and Secret

1. In the left sidebar, expand the **Settings** menu and select **Basic**. Here you can find the App ID and App Secret
1. Click on the **Show** button in the **App Secret** text box. Copy the App Id and App Secret to your channel configuration

### Verify Token

The verify token is used by Facebook to verify that you are the real owner of the provided webhook

You can generate any random alphanumerical string for this configuration. Paste it in your **Verify Token** channel configuration

### Page Id and Access Token

1. In the left sidebar, expand the **Messenger** menu and select **Settings**
1. In the **Access Tokens** section, click **Add or remove Pages** and add your facebook page
1. Copy the number under your page name and paste it in your **Page Id** channel configuration
1. Click on **Generate token**. Copy this token and paste it in the **Access Token** channel configuration

### Save Configuration

Channel configuration is complete, you can now click **Save**. It is important to save your configuration before configuring the webhook, otherwise Messenger will be unable to validate the Webhook URL.

## Webhook Configuration

To receive messages from Messenger, you will need to setup a webhook

1. Go to your Meta app.
1. In the left sidebar, expand the **Messenger** menu and select **Settings**
1. In the **Webhooks** section, click **Add Callback URL**
1. Copy paste the webhook url provided in the channel configuration UI
1. Copy paste the verify token you generated earlier
1. Click on **Verify and save**. Make sure your channel configuration was saved before doing this step, otherwise the webhook validation will fail
1. Click on **Add subscriptions** and add `messages` and `messaging_postbacks` to your webhook

## Submit your App for Meta Approval

When your app is in Development Mode, your bot will work for admins, developers, and testers of the app. After your app is approved and made public, it will work for the general public.

Read more about the [App Approval process](https://github.com/microsoft/botframework-sdk/issues/1465)

## Send Greeting/Welcome Message

You can create a customized greeting from your Page that will appear in Facebook messages and in the Messenger app when someone begins a conversation with your Page for the first time. Your Page's greeting will appear before any messages are sent.

Read more about the [Messenger Greeting/Welcome Message](https://www.facebook.com/help/1698046970464236)
